{"version":3,"file":"EnvironmentMap.js","sourceRoot":"","sources":["../src/EnvironmentMap.ts"],"names":[],"mappings":";;;;;;AAAA,sDAA8B;AAC9B,mDAAgD;AAkBhD;;;;GAIG;AACH,MAAa,cAAc;IAYzB,YAAmB,oBAAwD,EAAE;QAX5D,SAAI,GAAmC,IAAI,GAAG,EAAE,CAAC;QAYhE,sGAAsG;QACtG,oGAAoG;QACpG,qGAAqG;QACrG,MAAM,CAAC,cAAc,CAAC,IAAI,EAAE,cAAc,EAAE;YAC1C,UAAU,EAAE,IAAI;YAChB,GAAG,EAAE;gBACH,MAAM,IAAI,6BAAa,CAAC,mDAAmD,CAAC,CAAC;YAC/E,CAAC;SACF,CAAC,CAAC;QAEH,IAAI,CAAC,aAAa,GAAG,iBAAO,CAAC,QAAQ,KAAK,OAAO,CAAC;QAClD,IAAI,CAAC,eAAe,CAAC,iBAAiB,CAAC,CAAC;IAC1C,CAAC;IAED;;OAEG;IACI,KAAK;QACV,IAAI,CAAC,IAAI,CAAC,KAAK,EAAE,CAAC;IACpB,CAAC;IAED;;;;;;OAMG;IACI,GAAG,CAAC,IAAY,EAAE,KAAa;QACpC,MAAM,GAAG,GAAW,IAAI,CAAC,aAAa,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,IAAI,CAAC,WAAW,EAAE,CAAC;QACnE,IAAI,CAAC,IAAI,CAAC,GAAG,CAAC,GAAG,EAAE,EAAE,IAAI,EAAE,IAAI,EAAE,KAAK,EAAE,CAAC,CAAC;IAC5C,CAAC;IAED;;OAEG;IACI,KAAK,CAAC,IAAY;QACvB,MAAM,GAAG,GAAW,IAAI,CAAC,aAAa,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,IAAI,CAAC,WAAW,EAAE,CAAC;QACnE,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC;IACxB,CAAC;IAED;;OAEG;IACI,GAAG,CAAC,IAAY;QACrB,MAAM,GAAG,GAAW,IAAI,CAAC,aAAa,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,IAAI,CAAC,WAAW,EAAE,CAAC;QACnE,MAAM,KAAK,GAAkC,IAAI,CAAC,IAAI,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC;QAChE,IAAI,KAAK,KAAK,SAAS,EAAE;YACvB,OAAO,SAAS,CAAC;SAClB;QACD,OAAO,KAAK,CAAC,KAAK,CAAC;IACrB,CAAC;IAED;;OAEG;IACI,KAAK;QACV,OAAO,IAAI,CAAC,IAAI,CAAC,IAAI,EAAE,CAAC;IAC1B,CAAC;IAED;;OAEG;IACI,OAAO;QACZ,OAAO,IAAI,CAAC,IAAI,CAAC,MAAM,EAAE,CAAC;IAC5B,CAAC;IAED;;OAEG;IACI,SAAS,CAAC,cAA8B;QAC7C,KAAK,MAAM,KAAK,IAAI,cAAc,CAAC,OAAO,EAAE,EAAE;YAC5C,IAAI,CAAC,GAAG,CAAC,KAAK,CAAC,IAAI,EAAE,KAAK,CAAC,KAAK,CAAC,CAAC;SACnC;IACH,CAAC;IAED;;OAEG;IACI,eAAe,CAAC,oBAAwD,EAAE;QAC/E,KAAK,MAAM,CAAC,IAAI,EAAE,KAAK,CAAC,IAAI,MAAM,CAAC,OAAO,CAAC,iBAAiB,CAAC,EAAE;YAC7D,IAAI,KAAK,KAAK,SAAS,EAAE;gBACvB,IAAI,CAAC,GAAG,CAAC,IAAI,EAAE,KAAK,CAAC,CAAC;aACvB;SACF;IACH,CAAC;IAED;;OAEG;IACI,QAAQ;QACb,MAAM,MAAM,GAA2B,EAAE,CAAC;QAC1C,KAAK,MAAM,KAAK,IAAI,IAAI,CAAC,OAAO,EAAE,EAAE;YAClC,MAAM,CAAC,KAAK,CAAC,IAAI,CAAC,GAAG,KAAK,CAAC,KAAK,CAAC;SAClC;QACD,OAAO,MAAM,CAAC;IAChB,CAAC;CACF;AA9GD,wCA8GC","sourcesContent":["import process from 'process';\r\nimport { InternalError } from './InternalError';\r\n\r\n/**\r\n * A process environment variable name and its value.  Used by {@link EnvironmentMap}.\r\n * @public\r\n */\r\nexport interface IEnvironmentEntry {\r\n  /**\r\n   * The name of the environment variable.\r\n   */\r\n  name: string;\r\n\r\n  /**\r\n   * The value of the environment variable.\r\n   */\r\n  value: string;\r\n}\r\n\r\n/**\r\n * A map data structure that stores process environment variables.  On Windows\r\n * operating system, the variable names are case-insensitive.\r\n * @public\r\n */\r\nexport class EnvironmentMap {\r\n  private readonly _map: Map<string, IEnvironmentEntry> = new Map();\r\n\r\n  /**\r\n   * Whether the environment variable names are case-sensitive.\r\n   *\r\n   * @remarks\r\n   * On Windows operating system, environment variables are case-insensitive.\r\n   * The map will preserve the variable name casing from the most recent assignment operation.\r\n   */\r\n  public readonly caseSensitive: boolean;\r\n\r\n  public constructor(environmentObject: Record<string, string | undefined> = {}) {\r\n    // This property helps catch a mistake where an instance of `EnvironmentMap` is accidentally passed to\r\n    // a function that expects a `Record<string, string>` (as would be used with the `process.env` API).\r\n    // The property getter will throw an exception if that function tries to enumerate the object values.\r\n    Object.defineProperty(this, '_sanityCheck', {\r\n      enumerable: true,\r\n      get: function () {\r\n        throw new InternalError('Attempt to read EnvironmentMap class as an object');\r\n      }\r\n    });\r\n\r\n    this.caseSensitive = process.platform !== 'win32';\r\n    this.mergeFromObject(environmentObject);\r\n  }\r\n\r\n  /**\r\n   * Clears all entries, resulting in an empty map.\r\n   */\r\n  public clear(): void {\r\n    this._map.clear();\r\n  }\r\n\r\n  /**\r\n   * Assigns the variable to the specified value.  A previous value will be overwritten.\r\n   *\r\n   * @remarks\r\n   * The value can be an empty string.  To completely remove the entry, use\r\n   * {@link EnvironmentMap.unset} instead.\r\n   */\r\n  public set(name: string, value: string): void {\r\n    const key: string = this.caseSensitive ? name : name.toUpperCase();\r\n    this._map.set(key, { name: name, value });\r\n  }\r\n\r\n  /**\r\n   * Removes the key from the map, if present.\r\n   */\r\n  public unset(name: string): void {\r\n    const key: string = this.caseSensitive ? name : name.toUpperCase();\r\n    this._map.delete(key);\r\n  }\r\n\r\n  /**\r\n   * Returns the value of the specified variable, or `undefined` if the map does not contain that name.\r\n   */\r\n  public get(name: string): string | undefined {\r\n    const key: string = this.caseSensitive ? name : name.toUpperCase();\r\n    const entry: IEnvironmentEntry | undefined = this._map.get(key);\r\n    if (entry === undefined) {\r\n      return undefined;\r\n    }\r\n    return entry.value;\r\n  }\r\n\r\n  /**\r\n   * Returns the map keys, which are environment variable names.\r\n   */\r\n  public names(): IterableIterator<string> {\r\n    return this._map.keys();\r\n  }\r\n\r\n  /**\r\n   * Returns the map entries.\r\n   */\r\n  public entries(): IterableIterator<IEnvironmentEntry> {\r\n    return this._map.values();\r\n  }\r\n\r\n  /**\r\n   * Adds each entry from `environmentMap` to this map.\r\n   */\r\n  public mergeFrom(environmentMap: EnvironmentMap): void {\r\n    for (const entry of environmentMap.entries()) {\r\n      this.set(entry.name, entry.value);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Merges entries from a plain JavaScript object, such as would be used with the `process.env` API.\r\n   */\r\n  public mergeFromObject(environmentObject: Record<string, string | undefined> = {}): void {\r\n    for (const [name, value] of Object.entries(environmentObject)) {\r\n      if (value !== undefined) {\r\n        this.set(name, value);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Returns the keys as a plain JavaScript object similar to the object returned by the `process.env` API.\r\n   */\r\n  public toObject(): Record<string, string> {\r\n    const result: Record<string, string> = {};\r\n    for (const entry of this.entries()) {\r\n      result[entry.name] = entry.value;\r\n    }\r\n    return result;\r\n  }\r\n}\r\n"]}