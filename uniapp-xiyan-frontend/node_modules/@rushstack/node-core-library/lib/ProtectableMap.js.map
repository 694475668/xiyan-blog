{"version":3,"file":"ProtectableMap.js","sourceRoot":"","sources":["../src/ProtectableMap.ts"],"names":[],"mappings":";AAAA,4FAA4F;AAC5F,2DAA2D;;;AAE3D,6DAA0D;AA4B1D;;;;;;;;;;;;;;;;;GAiBG;AACH,MAAa,cAAc;IAGzB,YAAmB,UAA2C;QAC5D,IAAI,CAAC,cAAc,GAAG,IAAI,uCAAkB,CAAO,IAAI,EAAE,UAAU,CAAC,CAAC;IACvE,CAAC;IAED;;OAEG;IACH,IAAW,aAAa;QACtB,OAAO,IAAI,CAAC,cAAc,CAAC;IAC7B,CAAC;IAED,8EAA8E;IAC9E,qDAAqD;IAErD;;;OAGG;IACI,KAAK;QACV,IAAI,CAAC,cAAc,CAAC,iBAAiB,EAAE,CAAC;IAC1C,CAAC;IAED;;;OAGG;IACI,MAAM,CAAC,GAAM;QAClB,OAAO,IAAI,CAAC,cAAc,CAAC,kBAAkB,CAAC,GAAG,CAAC,CAAC;IACrD,CAAC;IAED;;;OAGG;IACI,GAAG,CAAC,GAAM,EAAE,KAAQ;QACzB,IAAI,CAAC,cAAc,CAAC,eAAe,CAAC,GAAG,EAAE,KAAK,CAAC,CAAC;QAChD,OAAO,IAAI,CAAC;IACd,CAAC;IAED,8EAA8E;IAC9E,oDAAoD;IAEpD;;OAEG;IACH,8DAA8D;IACvD,OAAO,CAAC,UAAsD,EAAE,OAAa;QAClF,IAAI,CAAC,cAAc,CAAC,OAAO,CAAC,UAAU,CAAC,CAAC;IAC1C,CAAC;IAED;;;;OAIG;IACI,GAAG,CAAC,GAAM;QACf,OAAO,IAAI,CAAC,cAAc,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC;IACtC,CAAC;IAED;;OAEG;IACI,GAAG,CAAC,GAAM;QACf,OAAO,IAAI,CAAC,cAAc,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC;IACtC,CAAC;IAED;;OAEG;IACH,IAAW,IAAI;QACb,OAAO,IAAI,CAAC,cAAc,CAAC,IAAI,CAAC;IAClC,CAAC;CACF;AA3ED,wCA2EC","sourcesContent":["// Copyright (c) Microsoft Corporation. All rights reserved. Licensed under the MIT license.\r\n// See LICENSE in the project root for license information.\r\n\r\nimport { ProtectableMapView } from './ProtectableMapView';\r\n\r\n/**\r\n * Constructor parameters for {@link ProtectableMap}\r\n *\r\n * @public\r\n */\r\nexport interface IProtectableMapParameters<K, V> {\r\n  /**\r\n   * An optional hook that will be invoked before Map.clear() is performed.\r\n   */\r\n  onClear?: (source: ProtectableMap<K, V>) => void;\r\n\r\n  /**\r\n   * An optional hook that will be invoked before Map.delete() is performed.\r\n   */\r\n  onDelete?: (source: ProtectableMap<K, V>, key: K) => void;\r\n\r\n  /**\r\n   * An optional hook that will be invoked before Map.set() is performed.\r\n   * @remarks\r\n   * If this hook is provided, the function MUST return the `value` parameter.\r\n   * This provides the opportunity to modify the value before it is added\r\n   * to the map.\r\n   */\r\n  onSet?: (source: ProtectableMap<K, V>, key: K, value: V) => V;\r\n}\r\n\r\n/**\r\n * The ProtectableMap provides an easy way for an API to expose a `Map<K, V>` property\r\n * while intercepting and validating any write operations that are performed by\r\n * consumers of the API.\r\n *\r\n * @remarks\r\n * The ProtectableMap itself is intended to be a private object that only its owner\r\n * can access directly.  Any operations performed directly on the ProtectableMap will\r\n * bypass the hooks and any validation they perform.  The public property that is exposed\r\n * to API consumers should return {@link ProtectableMap.protectedView} instead.\r\n *\r\n * For example, suppose you want to share your `Map<string, number>` data structure,\r\n * but you want to enforce that the key must always be an upper case string:\r\n * You could use the onSet() hook to validate the keys and throw an exception\r\n * if the key is not uppercase.\r\n *\r\n * @public\r\n */\r\nexport class ProtectableMap<K, V> {\r\n  private readonly _protectedView: ProtectableMapView<K, V>;\r\n\r\n  public constructor(parameters: IProtectableMapParameters<K, V>) {\r\n    this._protectedView = new ProtectableMapView<K, V>(this, parameters);\r\n  }\r\n\r\n  /**\r\n   * The owner of the protectable map should return this object via its public API.\r\n   */\r\n  public get protectedView(): Map<K, V> {\r\n    return this._protectedView;\r\n  }\r\n\r\n  // ---------------------------------------------------------------------------\r\n  // lib.es2015.collections contract - write operations\r\n\r\n  /**\r\n   * Removes all entries from the map.\r\n   * This operation does NOT invoke the ProtectableMap onClear() hook.\r\n   */\r\n  public clear(): void {\r\n    this._protectedView._clearUnprotected();\r\n  }\r\n\r\n  /**\r\n   * Removes the specified key from the map.\r\n   * This operation does NOT invoke the ProtectableMap onDelete() hook.\r\n   */\r\n  public delete(key: K): boolean {\r\n    return this._protectedView._deleteUnprotected(key);\r\n  }\r\n\r\n  /**\r\n   * Sets a value for the specified key.\r\n   * This operation does NOT invoke the ProtectableMap onSet() hook.\r\n   */\r\n  public set(key: K, value: V): this {\r\n    this._protectedView._setUnprotected(key, value);\r\n    return this;\r\n  }\r\n\r\n  // ---------------------------------------------------------------------------\r\n  // lib.es2015.collections contract - read operations\r\n\r\n  /**\r\n   * Performs an operation for each (key, value) entries in the map.\r\n   */\r\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n  public forEach(callbackfn: (value: V, key: K, map: Map<K, V>) => void, thisArg?: any): void {\r\n    this._protectedView.forEach(callbackfn);\r\n  }\r\n\r\n  /**\r\n   * Retrieves the value for the specified key.\r\n   * @returns undefined if the value is undefined OR if the key is missing;\r\n   * otherwise returns the value associated with the key.\r\n   */\r\n  public get(key: K): V | undefined {\r\n    return this._protectedView.get(key);\r\n  }\r\n\r\n  /**\r\n   * Returns true if the specified key belongs to the map.\r\n   */\r\n  public has(key: K): boolean {\r\n    return this._protectedView.has(key);\r\n  }\r\n\r\n  /**\r\n   * Returns the number of (key, value) entries in the map.\r\n   */\r\n  public get size(): number {\r\n    return this._protectedView.size;\r\n  }\r\n}\r\n"]}