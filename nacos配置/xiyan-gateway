management:
  # 端点检查（健康检查）
  endpoints:
    web:
      exposure:
        include: "*"
spring:
  cloud:
    nacos:
      discovery:
        server-addr: nacos:8848
        namespace: prod
    gateway:
      #处理跨域
      globalcors:
        corsConfigurations:
          '[/**]':
            allowedHeaders: "*"
            allowedOrigins: "*"
            allowedMethods: "*"
      discovery:
        locator:
          #false为服务名不自动匹配，true则相反
          enabled: false
          #服务名以小写进行匹配
          lowerCaseServiceId: true
      routes:
        #web服务
        - id: service-1
          uri: lb://xiyan-web-service
          predicates:
            - Path=/web/article/list
          filters:
          #不开启token验证
            - Authorize=false
            - StripPrefix=1
        
        - id: service-2
          uri: lb://xiyan-web-service
          predicates:
            - Path=/web/article/byId/*
          filters:
          #不开启token验证
            - Authorize=false
            - StripPrefix=1
        
        - id: service-3
          uri: lb://xiyan-web-service
          predicates:
            - Path=/web/code/tag/list
          filters:
          #不开启token验证
            - Authorize=false
            - StripPrefix=1
        
        - id: service-4
          uri: lb://xiyan-web-service
          predicates:
            - Path=/web/code/list
          filters:
          #不开启token验证
            - Authorize=false
            - StripPrefix=1
        
        - id: service-5
          uri: lb://xiyan-web-service
          predicates:
            - Path=/web/code/byId/*
          filters:
          #不开启token验证
            - Authorize=false
            - StripPrefix=1
        
        - id: service-6
          uri: lb://xiyan-web-service
          predicates:
            - Path=/web/link/list
          filters:
          #不开启token验证
            - Authorize=false
            - StripPrefix=1
        
        
        - id: service-7
          uri: lb://xiyan-web-service
          predicates:
            - Path=/web/message/list
          filters:
          #不开启token验证
            - Authorize=false
            - StripPrefix=1

        - id: service-8
          uri: lb://xiyan-web-service
          predicates:
            - Path=/web/message/add
          filters:
          #不开启token验证
            - Authorize=false
            - StripPrefix=1
        
        - id: service-9
          uri: lb://xiyan-web-service
          predicates:
            - Path=/web/music/list
          filters:
          #不开启token验证
            - Authorize=false
            - StripPrefix=1

        - id: service-10
          uri: lb://xiyan-web-service
          predicates:
            - Path=/web/aes/key
          filters:
          #不开启token验证
            - Authorize=false
            - StripPrefix=1
        
        - id: service-11
          uri: lb://xiyan-web-service
          predicates:
            - Path=/web/comment/list
          filters:
          #不开启token验证
            - Authorize=false
            - StripPrefix=1

        - id: service-12
          uri: lb://xiyan-web-service
          predicates:
            - Path=/web/article/browse/*
          filters:
          #不开启token验证
            - Authorize=false
            - StripPrefix=1

        - id: service-13
          uri: lb://xiyan-web-service
          predicates:
            - Path=/web/article/like/*
          filters:
          #不开启token验证
            - Authorize=false
            - StripPrefix=1

        - id: service-14
          uri: lb://xiyan-web-service
          predicates:
            - Path=/web/code/browse/*
          filters:
          #不开启token验证
            - Authorize=false
            - StripPrefix=1

        - id: service-15
          uri: lb://xiyan-web-service
          predicates:
            - Path=/web/code/like/*
          filters:
          #不开启token验证
            - Authorize=false
            - StripPrefix=1

        - id: service-16
          uri: lb://xiyan-web-service
          predicates:
            - Path=/web/pay/back
          filters:
          #不开启token验证
            - Authorize=false
            - StripPrefix=1

        - id: service-17
          uri: lb://xiyan-web-service
          predicates:
            - Path=/web/tv/list
          filters:
          #不开启token验证
            - Authorize=false
            - StripPrefix=1


        - id: service-18
          uri: lb://xiyan-web-service
          predicates:
            - Path=/web/**
          filters:
          #不开启token验证
            - Authorize=true
            - StripPrefix=1

        - id: service-19
          uri: lb://oss-service
          predicates:
            - Path=/oss/**
          filters:
          #开启token验证
            - Authorize=true
            - StripPrefix=1

        - id: service-20
          uri: lb://search-service
          predicates:
            - Path=/search/technology/list
          filters:
          #开启token验证
            - Authorize=false
            - StripPrefix=1

        - id: service-21
          uri: lb://search-service
          predicates:
            - Path=/search/**
          filters:
          #开启token验证
            - Authorize=true
            - StripPrefix=1
        
        - id: service-22
          uri: lb://system-base-service
          predicates:
            - Path=/system/qq/login
          filters:
          #开启token验证
            - Authorize=false
            - StripPrefix=1
        
        - id: service-23
          uri: lb://system-base-service
          predicates:
            - Path=/system/user/send
          filters:
          #不开启token验证
            - Authorize=false
            - StripPrefix=1

        - id: service-24
          uri: lb://system-base-service
          predicates:
            - Path=/system/user/register
          filters:
          #不开启token验证
            - Authorize=false
            - StripPrefix=1

        - id: service-25
          uri: lb://system-base-service
          predicates:
            - Path=/system/user/retrieve
          filters:
          #不开启token验证
            - Authorize=false
            - StripPrefix=1
        
        - id: service-26
          uri: lb://system-base-service
          predicates:
            - Path=/system/qq/back
          filters:
          #不开启token验证
            - Authorize=false
            - StripPrefix=1

        - id: service-27
          uri: lb://system-base-service
          predicates:
            - Path=/system/weibo/back
          filters:
          #不开启token验证
            - Authorize=false
            - StripPrefix=1
        
        - id: service-28
          uri: lb://system-base-service
          predicates:
            - Path=/system/leaderboard/**
          filters:
          #不开启token验证
            - Authorize=false
            - StripPrefix=1

        - id: service-29
          uri: lb://system-base-service
          predicates:
            - Path=/system/user/by
          filters:
          #不开启token验证
            - Authorize=false
            - StripPrefix=1

        - id: service-30
          uri: lb://system-base-service
          predicates:
            - Path=/system/user/update
          filters:
          #不开启token验证
            - Authorize=false
            - StripPrefix=1

        - id: service-31
          uri: lb://system-base-service
          predicates:
            - Path=/system/user/login
          filters:
          #不开启token验证
            - Authorize=false
            - StripPrefix=1

        
        - id: service-32
          uri: lb://system-base-service
          predicates:
            - Path=/system/**
          filters:
          #不开启token验证
            - Authorize=true
            - StripPrefix=1
        
    #Sentinel         
    sentinel:
      datasource:
        gate-way-flow: 
          nacos:
            #如果你的配置分为了很多的环境，那么这个一定要配置，不然会出现找不到
            namespace: prod
            data-id: xiyan-gateway-rules
            group-id: DEFAULT_GROUP
            rule-type: gw_flow
            server-addr: nacos:8848
      transport:
        dashboard: sentinel:8888  
    # gateway 流控规则持久化配置  
      # 限流返回的响应
      scg:
        fallback:
          mode: response
          response-status: 455
          response-body: 您操作过快，请稍后在试!   
            #springCloudSleuth
  zipkin:
    baseUrl: http://zipkin:9411/
    enabled: true
    sender: 
      type: kafka
    service: 
      name: xiyan-gateway-service
  #区间是0.1到1， 1代表保存所有的链路， 0.1表示保存10%的链路
  sleuth:
    sampler: 
      probability: 1
  kafka: 
    bootstrap-servers: kafka-service:9092
  redis: 
    host: redis
    port: 6379
    timeout: 5000
    password: yoostar403
    cache:
      expires: -1
# 序列化key
redis-key: xiyan
